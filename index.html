<html>
    <head>
        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/white.css">
    </head>
    <head>
  		<meta charset="utf-8">

  		<title>Hunting Threat Actors with SSL Certificates</title>

  		<meta name="description" content="A journey in using ssl certificates from censys.io and scans.io to hunt threat actors and perform computer network defense ">
  		<meta name="author" content="Mark Parsons">

  		<meta name="apple-mobile-web-app-capable" content="yes">
  		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  		<link rel="stylesheet" href="css/reveal.css">
  		<link rel="stylesheet" href="css/theme/league.css" id="theme">

  		<!-- Code syntax highlighting -->
  		<link rel="stylesheet" href="lib/css/zenburn.css">

  		<!-- Printing and PDF exports -->
  		<script>
  			var link = document.createElement( 'link' );
  			link.rel = 'stylesheet';
  			link.type = 'text/css';
  			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  			document.getElementsByTagName( 'head' )[0].appendChild( link );
  		</script>

  		<!--[if lt IE 9]>
  		<script src="lib/js/html5shiv.js"></script>
  		<![endif]-->
  	</head>

    <body>
        <div class="reveal">
            <div class="slides">
              <!-- Title -->
              <section>
      					<h1>Hunting Threat Actors with SSL Certificates</h1>
      					<h3> Using open source data to hunt threat actors and defend networks</h3>
      					<p>
      						<a href="https://github.com/mpars0ns">Mark Parsons</a> / <a href="https://twitter.com/markpars0ns">@markpars0ns</a>
      					</p>
      				</section>

              <!-- Introduction -->
              <section>
                  <section>
                      <h1>Introduction</h1>
                  </section>
                  <section id="fragments">
                      <h1>Who am I</h1>
                      <h3>Mark Parsons</h3>
                      <ul class="fragment">
            						<li>Incident responder and Network defender</li>
            						<li>Small time python programmer</li>
            						<li>Occasional Threat Analyst</li>
            					</ul>
                    </section>
                  <section id="fragments">
                      <h2>Who am I not</h2>
                      <p>Animator - Archer</p>
                      <img class="fragment" data-src='images/archer_credits.png'>
                  </section>
                  <section>
                      <h2>One Direction Fan Fiction???</h2>
                      <img data-src='images/wired_fan_fict.png'>
                  </section>
                </section>

                <section>
                  <h2> Tradtional methods of hunting </h2>
                  <ul>
                    <li>Whois tracking </li>
                    <li>Name server monitoring</li>
                    <li>Passive DNS</li>
                    <li> Malware/Implant tracking (VT, Malwr, TotalHash etc)</li>
                  </ul>
                </section>
                <section id="fragments">
                  <h2>What else could we do that provides pivotable/trackable data</h2>
                  <p> Hint: Its all about secure sockets or transport layer security</p>
                  <p class="fragment">That's right SSL/TLS certificates!!!</p>
                </section>
                <!-- reminder SSL/TLS not code signing -->
                <section>
                  <section>
                  <h2>Quick Caveat</h2>
                  <p> Code signing certificate != SSL/TLS certificate </p>
                  </section>
                  <section>
                    <h3> Code signing </h3>
                    <img data-src="images/chrome_signed.png">
                  </section>
                  <section>
                    <h3> SSL/TLS certificate </h3>
                    <img data-src="images/google_tls.png">
                  </section>
                </section>

                <!-- scans.io and censys.io -->

                <section>
                  <section id="fragments">
                  <h3> So ssl certificates you say?</h3>
                  <h3> Where do you start? </h3>
                  <p> First you need some data </p>
                  <img class="fragment" data-src="images/scan_allthethings.jpeg">
                </section>
                  <section>
                  <h3> You could ingest <a href='http://scans.io'>scans.io</a> sonar ssl scans</h3>
                   <br>
                   <p> Checkout my <a href="https://github.com/mpars0ns/scansio-sonar-es">Scansio-Sonar-ES</a> github repo </p>
                  </section>
                  <section>
                  <h3> Or use  <a href='https://censys.io'>censys.io</a></h3>
                </section>
                <section>
                  <h3> Or use <a href='https://passivetotal.org'>passive total</a></h3>
                </section>
              </section>

              <!-- scans.io -->
              <section>
                <h3><a href="https://scans.io/study/sonar.ssl">Scans.io</a> Sonar ssl scans</h3>
                <p> Scans performed by Rapid7 </p>
                <ul>
                  <li>Raw data going back to 10/30/2013 </li>
                  <li>Easily consumable</li>
                  <li>Updated weekly </li>
                  <li>Incremental in nature
                    <ul>
                      <li>certs.gz - Only new sha1s and base64 raw cert seen that week </li>
                      <li>hosts.gz - SHA1 and host for all hosts seen </li>
                    </ul>
                  </li>
                  <li>No public search interface </li>
                  <li>Is weekly frequent enough?</li>
              </section>

              <!-- censys.io -->
              <section>
                <h3><a href="https://censys.io/">Censys.io</a></h3>
                <p> Maintained by the University of Michigan and University of Illinois Urbana-Champaign</p>
                <ul>
                  <li>Easy to use search interface</li>
                  <li>API Access</li>
                  <li>Frequent Updates</li>
                  <li>All or nothing in nature
                    <ul>
                      <li>If there is a delta between scans</li
                        <li>old scan data is not in main search interface</li>
                      <li>Old scan data is available in json format</li>
                    </ul>
                  </li>
                </ul>
              </section>

              <!-- passive total -->
              <section>
                <section>
                <h3><a href="https://passivetotal.org/">PassiveTotal</a></h3>
                <ul>
                  <li>Should be the first place any analyst goes when performing any infrastructure hunting</li>
                  <li>Merge tradtional hunting with new methods</li>
                  <li>Aggregates multiple passive DNS sources</li>
                  <li>Provides WHOIS data </li>
                  <li>Provides references to OpenSource reporting</li>
                  <li>Also has SSL certificates</li>
                  <li>So much more I am only touching the surface</li>
                </ul>
              </section>
              <section>
                <h3>If you aren't you using it</h3>
                <h3>You really should try it out</h3>
                <h3> You won't regret it </h3>
                <p>Disclamer: PassiveTotal provided me researcher access for data required for this presentation</p>
              </section>
            </section>
              <!-- network defense -->
              <section>
                <section>
                <h3>Network Defense</h3>
              </section>
              <section>
                <h3>What you can do to defend your networks<h3>
              </section>
              <section>
                <h3>IDS Monitoring - SSL fingerprints </h3>
              </ul>
                    <li> Suricata </li>
                    <li> BRO intel framework </li>
                  </ul>
                </section>
                <section>

                <h3>Automate tracking of ssl certs</h3>
                  <ul>
                    <li><a href="https://passivetotal.org">Passive Total</a> Monitoring</li>
                    <li><a href="https://censys.io">Censys.io</a> api script</li>
                    <li>Your own local sonar or censys.io repo </li>
                    <li>Combo of all of these </li>
                    <li>Put new ip addresses found into monitoring/blocks as needed</li>
                  </ul>

              </ul>
            </section>
              </section>
              <section>
                <section>
                  <h3> More Network defense</h3>
                </section>

              <section>
                <h3>More Like Network Hygeine</h3>
                <br>
                <p>Most of these you will have to do with your own sonar scan data or <a href="https://censys.io">censys.io</a> data </p>
                </section>
                <section>
                  <h3>Look at your netblocks </h3>
                  <ul>
                    <li>Use your ASN for a censys.io search</li>
                    <li>Use your ASN or subnets if sonar data in elasticsearch</li>
                  </ul>
                </section>
                <section>
                  <h3>What to look for </h3>
                  <ul>
                    <li>Your security appliances</li>
                    <li>Remote access managment
                      <ul>
                      <li>HP integrated Lights Out</li>
                      <li>Dell Remote Access Card</li></ul>
                    </li>
                    <li>Websites or services you didn't know about</li>
                  </ul>
                </section>
                <section>
                  <h3>Look outside your netblocks</h3>
                  <ul>
                    <li>Look for certs for your org not inside your netblocks</li>
                    <li>Look for certs that have email addresses from your org</li>
                    <li>Look for certs who have your org as a Subject Alt Name</li>
                    <li>Look for dopple gangers of your org </li>
                    <li>Take a look at Passive Total keyword searching (DNS, Whois, SSL ) aka brand monitoring</li>
                </section>
              </section>
              <section>
                <section>
                  <h3>SSL Hunting Basics</h3>
                  <h3>Tips to help you get started </h3>
                </section>
                <section>
                  <h3> Where to start </h3>
                  <ul>
                    <li>IP to Cert</li>
                    <li>Cert to IP</li>
                  </ul>
                </section>
                <section>
                  <h3> What to consider </h3>
                  <ul>
                    <li>Look at the time frame cert was seen on an IP</li>
                    <li>Was cert seen during malicious ativity ?</li>
                    <li>Do you have malware/implant using ssl ?</li>
                    <li>How many other hosts are seen using that ssl cert?</li>
                    <li>Expiration dates on certs</li>
                    <li>Issuer
                      <ul>
                        <li>Self Signed </li>
                        <li>Free cert </li>
                        <li>Paid cert </li>
                      </ul>
                    </li>
                  </ul>
                </section>
            </section>
              <!-- threat actor -->
              <section>
                <h2>Let's do some SSL hunting/pivoting</h2>
              </section>

              <section>
                <section>
                <h3>CVE-2014-1761</h3>
                <h3>Remote Code Execution - Word RTF Memory Corruption Vulnerability </h3>
              </section>
              <section>
                <h3>Awesome <a href="https://blogs.technet.microsoft.com/srd/2014/03/24/security-advisory-2953095-recommendation-to-stay-protected-and-for-detections/">technet</a> article</h3>
                <h3>Yara Sigs!</h3>
                <h3>SSL SHA1 Hash</h3>
                <h3>Command and Control IP</h3>
                <h3>Potential Command and Control Domain</h3>
              </section>
              <section>
                <h3>Starting point</h3>
                <img data-src='images/ms_technet_starting.jpg'>
              </section>
              <section>
                <h3>Let's do some traditional pivots</h3>
                <h4>Passive DNS records for times when the SSL certs were active</h4>
                <h4>Whois on any relavant domains found</h4>
              </section>
              <section>
                <img data-src='images/ms_technet_tradtional.jpg'>
              </section>
              <section>
                <h3>Now let's pivot on the SSL SHA1</h3>
                <h3>SHA1: df7240fb9bcd5312eba5f9c2dde7a29a1dc8f355 </h3>

              </section>
              <section>
                <img data-src='images/ms_technet_sslfirst.jpg'>
              </section>
            <section>
              <h3>Timeframe</h3>
              <table>
                <thead>
                  <tr>
                    <th>IP</th>
                    <th>First Seen</th>
                    <th>Last Seen</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class='green'>
                    <td> 37.0.121.103 </td>
                    <td> Oct. 30, 2013 </td>
                    <td> Dec. 29, 2014 </td>
                  </tr>
                  <tr class='orange'>
                    <td > 185.12.44.51 </td>
                    <td> Oct. 30, 2013 </td>
                    <td> April 7, 2014 </td>
                  </tr>
                  <tr class='green'>
                    <td g>186.5.138.40 </td>
                    <td> Oct. 30, 2013 </td>
                    <td> Jan. 13, 2014 </td>
                  </tr>
                  <tr class='white'>
                    <td> 23.229.114.136 </td>
                    <td> April 14, 2014 </td>
                    <td> April 14, 2014 </td>
                  </tr>
                  <tr class='white'>
                    <td> 185.12.44.52 </td>
                    <td> April 14, 2014 </td>
                    <td> July 14, 2014 </td>
                  </tr>
                  <tr class='white'>
                    <td> 23.229.114.177 </td>
                    <td> April 14, 2014 </td>
                    <td> July 14, 2014 </td>
                  </tr>
                </tbody>
              </table>
            </section>
            <section>
              <h3>Success!!!!</h3>
              <br>
              <h3>Go from one SSL Cert, one IP, and one Domain</h3>
              <br>
              <h3>Get 6 IPs and Three Domains using same registration info</h3>
              <br>
            </section>
            <section data-background="images/ron_happy.gif">
            </section>
          </section>
          <section>
              <section>
               <h3>Palo Alto - Lotus Blossom </h3>
               <img data-src='images/oplotusblossom.png'>
              </section>
              <section>
                <p>Great write up on targeting of Hong Kong, Taiwan, Vietnam, the Philippines, and Indonesia and the use of the Elise trojan</p>
                <p>Provided easily parseable iocs on <a href='https://github.com/pan-unit42/iocs/tree/master/lotusblossom'>github</a></p>
              </section>
              <section>
                <h3>IP iocs</h3>
                <img data-src='images/oplotus_ips_start.jpg'>
              </section>
              <section>
                <h3>SSL Pivot</h3>
                <img data-src='images/oplotus_ssl_first.jpg'>
              </section>
              <section>
                <h3>Hmmm several ip's all using the same ssl cert</h3>
                <h3>Could there be more?</h3>
                </section>
                <section>
                  <img data-src='images/oplotus_ssl_second.jpg'>
                </section>

                <section>
                  <h3>Yup! there is more - lots more</h3>
                  <h3> Almost 300 different ip addresses </h3>

                  <br>
                  <h3>Certificate Issuer: Eric-Office </h3>
                  <h3> Certificate Subject: Eric-Office </h3>
                  <h3> Validty Dates: 2012-02-13 - 2022-02-10 </h3>
                </section>
                <section>
                  <h3>Sonar dates </h3>
                  <h3> First seen  2013-10-30 </h3>
                  <h3> Last seen 2016-04-11 </h3>
                  <br>
                  <h3>Still very active today</h3>
                </section>
          </section>
              <section>
                APT 28
              </section>
              <section>
                Posedion - Point of Sale not Brazil Pentest company
              </section>
              <!-- conclusion -->
            </div>
        </div>
        <script src="js/reveal.js"></script>
        <script>
            Reveal.initialize();
        </script>
    </body>
</html>
