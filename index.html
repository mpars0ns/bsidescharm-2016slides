<html>
    <head>
        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/white.css">
    </head>
    <head>
  		<meta charset="utf-8">

  		<title>Hunting Threat Actors with SSL Certificates</title>

  		<meta name="description" content="A journey in using ssl certificates from censys.io and scans.io to hunt threat actors and perform computer network defense ">
  		<meta name="author" content="Mark Parsons">

  		<meta name="apple-mobile-web-app-capable" content="yes">
  		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  		<link rel="stylesheet" href="css/reveal.css">
  		<link rel="stylesheet" href="css/theme/league.css" id="theme">

  		<!-- Code syntax highlighting -->
  		<link rel="stylesheet" href="lib/css/zenburn.css">

  		<!-- Printing and PDF exports -->
  		<script>
  			var link = document.createElement( 'link' );
  			link.rel = 'stylesheet';
  			link.type = 'text/css';
  			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  			document.getElementsByTagName( 'head' )[0].appendChild( link );
  		</script>

  		<!--[if lt IE 9]>
  		<script src="lib/js/html5shiv.js"></script>
  		<![endif]-->
  	</head>

    <body>
        <div class="reveal">
            <div class="slides">
              <!-- Title -->
              <section>
      					<h1>Hunting Threat Actors with SSL Certificates</h1>
      					<h3> Using open source data to hunt threat actors and defend networks</h3>
      					<p>
      						<a href="https://github.com/mpars0ns">Mark Parsons</a> / <a href="https://twitter.com/markpars0ns">@markpars0ns</a>
      					</p>
      				</section>

              <!-- Introduction -->
              <section>
                  <section>
                      <h1>Introduction</h1>
                  </section>
                  <section id="fragments">
                      <h1>Who am I</h1>
                      <h3>Mark Parsons</h3>
                      <ul class="fragment">
            						<li>Incident responder and Network defender</li>
            						<li>Small time python programmer</li>
            						<li>Occasional Threat Analyst</li>
            					</ul>
                    </section>
                  <section id="fragments">
                      <h2>Who am I not</h2>
                      <p class="fragment">Animator - Archer</p>
                      <img class="fragment" data-src='images/archer_credits.png'>
                  </section>
                  <section id="fragments">
                      <h2 class="fragment">One Direction Fan Fiction???</h2>
                      <img class="fragment" data-src='images/wired_fan_fict.png'>
                  </section>
                </section>

                <section>
                  <h2> Tradtional methods of hunting </h2>
                  <ul>
                    <li>Whois tracking </li>
                    <li>Name server monitoring</li>
                    <li>Passive DNS</li>
                    <li> Malware/Implant tracking (VT, Malwr, TotalHash etc)</li>
                  </ul>
                </section>
                <section id="fragments">
                  <h2>What else could we do that provides pivotable/trackable data</h2>
                  <p> Hint: Its all about secure sockets or transport layer security</p>
                  <p class="fragment">That's right SSL/TLS certificates!!!</p>
                </section>
                <!-- reminder SSL/TLS not code signing -->
                <section>
                  <section>
                  <h2>Quick Caveat</h2>
                  <p> Code signing certificate != SSL/TLS certificate </p>
                  </section>
                  <section>
                    <h3> Code signing </h3>
                    <img data-src="images/chrome_signed.png">
                  </section>
                  <section>
                    <h3> SSL/TLS certificate </h3>
                    <img data-src="images/google_tls.png">
                  </section>
                </section>

                <!-- scans.io and censys.io -->

                <section>
                  <section id="fragments">
                  <h3> So ssl certificates you say?</h3>
                  <h3> Where do you start? </h3>
                  <p> First you need some data </p>
                  <img class="fragment" data-src="images/scan_allthethings.jpeg">
                </section>
                  <section>
                  <h3> You could ingest <a href='http://scans.io'>scans.io</a> sonar ssl scans</h3>
                   <br>
                   <p> Checkout my <a href="https://github.com/mpars0ns/scansio-sonar-es">Scansio-Sonar-ES</a> github repo </p>
                  </section>
                  <section>
                  <h3> Or use  <a href='https://censys.io'>censys.io</a></h3>
                </section>
                <section>
                  <h3> Or use <a href='https://passivetotal.org'>passive total</a></h3>
                </section>
              </section>

              <!-- scans.io -->
              <section>
                <h3><a href="https://scans.io/study/sonar.ssl">Scans.io</a> Sonar ssl scans</h3>
                <p> Scans performed by Rapid7 </p>
                <ul>
                  <li>Raw data going back to 10/30/2013 </li>
                  <li>Easily consumable</li>
                  <li>Updated weekly </li>
                  <li>Incremental in nature
                    <ul>
                      <li>certs.gz - Only new sha1's and base64 raw cert seen that week </li>
                      <li>hosts.gz - SHA1 and host for all hosts seen </li>
                    </ul>
                  </li>
                  <li>No public search interface </li>
                  <li>Is weekly frequent enough?</li>
              </section>

              <!-- censys.io -->
              <section>
                <h3><a href="https://censys.io/">Censys.io</a></h3>
                <p> Maintained by the University of Michigan and University of Illinois Champaign Urbana</p>
                <ul>
                  <li>Easy to use search interface</li>
                  <li>API Access</li>
                  <li>Frequent Updates</li>
                  <li>All or nothing in nature
                    <ul>
                      <li>If there is a delta between scans</li
                        <li>old scan data is not in main search interface</li>
                      <li>Old scan data is available in json format</li>
                    </ul>
                  </li>
                </ul>
              </section>

              <!-- passive total -->
              <section>
                <section>
                <h3><a href="https://passivetotal.org/">PassiveTotal</a></h3>
                <ul>
                  <li>Should be the first place any analyst goes when performing any infrastructure hunting</li>
                  <li>Merge tradtional hunting with new methods</li>
                  <li>Aggregates multiple passive DNS sources</li>
                  <li>Provides WHOIS data </li>
                  <li>Provides references to OpenSource reporting</li>
                  <li>Also has SSL certificates</li>
                  <li>So much more we are only touching the surface</li>
                </ul>
              </section>
              <section>
                <h3>If you aren't you using it</h3>
                <h3>You really should try it out</h3>
                <h3> You won't regret it </h3>
                <p>Disclamer: PassiveTotal provided me researcher access for data required for this presentation</p>
              </section>
            </section>
              <!-- network defense -->
              <section>
                <section>
                  <h3>Network defense</h3>
                </section>
                <section>
                <h3><strike>Network defense</strike></h3>
              </section>
              <section>
                <h3>Network Hygeine</h3>
                <br>
                <p>Most of these you will have to do with your own sonar scan data or <a href="https://censys.io">censys.io</a> data </p>
                </section>
                <section>
                  <h3>Look at your netblocks </h3>
                  <ul>
                    <li>Use your ASN for a censys.io search</li>
                    <li>Use your ASN or subnets if sonar data in elasticsearch</li>
                  </ul>
                </section>
                <section>
                  <h3>What to look for </h3>
                  <ul>
                    <li>Your security appliances</li>
                    <li>Remote access managment
                      <ul>
                      <li>HP integrated Lights Out</li>
                      <li>Dell Remote Access Card</li></ul>
                    </li>
                    <li>Websites or services you didn't know about</li>
                  </ul>
                </section>
                <section>
                  <h3>Look outside your netblocks</h3>
                  <ul>
                    <li>Look for certs for your org not inside your netblocks</li>
                    <li>Look for certs that have email addresses from your org</li>
                    <li>Look for certs who have your org as a Subject Alt Name</li>
                </section>
              </section>

              <section>
                More network defense
              </section>

              <!-- threat actor -->
              <section>
                <h2>Let's do some SSL hunting/pivoting</h2>
              </section>

              <section>
                <section>
                <h3>CVE-2014-1761</h3>
                <h3>Remote Code Execution - Word RTF Memory Corruption Vulnerability </h3>
              </section>
              <section>
                <h3>Awesome <a href="https://blogs.technet.microsoft.com/srd/2014/03/24/security-advisory-2953095-recommendation-to-stay-protected-and-for-detections/">technet</a> article</h3>
                <h3>Yara Sigs!</h3>
                <h3>SSL SHA1 Hash</h3>
                <h3>Command and Control IP</h3>
                <h3>Potential Command and Control Domain</h3>
              </section>
            <section>
              <h3>Let's pivot on the IP and SSL SHA1</h3>
              <h5>IP: 185.12.44.51 </h5>
              <h5>SHA1: df7240fb9bcd5312eba5f9c2dde7a29a1dc8f355 </h5>
              <img data-src='images/technet_initial.png'>
            </section>
            <section>
              <h3>SSL Pivot</h3>
              <img data-src='images/technet_sslpivot.png'>
            </section>
            <section>
              <h3>Let's do some traditional pivots</h3>
              <h4>Passive DNS for times when the SSL certs were active</h4>
              <h4>Whois on any relavant domains found</h4>
            </section>
            <section>
              <h3>Tradtional Pivots</h3>
              <img data-src='images/technet_tradtional_pivot.png'>
            </section>
            <section>
              <h3>Success!!!!</h3>
              <br>
              <h3>Go from one SSL Cert, one IP, and one Domain</h3>
              <br>
              <h3>Get 6 IPs and Three Domains using same registration info</h3>
              <br>
            </section>
            <section data-background="images/ron_happy.gif">
            </section>
          </section>
              <section>
                Threat actor b
              </section>
              <section>
                Threat actor c
              </section>
              <section>
                Threat actor d
              </section>
              <section>
                Threat actor e
              </section>

              <!-- conclusion -->


            </div>
        </div>
        <script src="js/reveal.js"></script>
        <script>
            Reveal.initialize();
        </script>
    </body>
</html>
